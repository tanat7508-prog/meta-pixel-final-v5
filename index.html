<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meta Pixel + Make.com Integration (Login + Popup)</title>
  <style>
    body {font-family:'Prompt',system-ui,sans-serif;background:#fff6f8;text-align:center;margin:0;padding:24px;}
    h2 {color:#ff517a;margin-top:0;}
    .btn {background:#111;color:#fff;border:none;border-radius:8px;padding:10px 16px;margin:6px;cursor:pointer;font-weight:600;font-size:14px;min-width:140px;}
    .btn:hover {opacity:.8;}
    .wrap-btns {display:flex;flex-wrap:wrap;justify-content:center;max-width:640px;margin:0 auto 24px;}
    .log {background:#0f1116;color:#0f0;font-family:monospace;font-size:12px;padding:12px;border-radius:8px;text-align:left;max-width:640px;margin:0 auto;min-height:120px;box-shadow:0 8px 20px rgba(0,0,0,.2);}
    .popup {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;}
    .popup-content {background:white;padding:24px;border-radius:12px;width:300px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.2);}
    .popup input {width:100%;padding:8px;font-size:16px;margin-top:10px;border:1px solid #ccc;border-radius:8px;}
    .popup button {margin-top:12px;padding:10px 16px;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
    .btn-confirm {background:#ff517a;color:white;}
    .btn-cancel {background:#999;color:white;margin-left:8px;}
  </style>

  <!-- ‚úÖ Meta Pixel -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1151872007088616');
    fbq('track', 'PageView');
  </script>
</head>

<body>
  <h2>üß† ‡πÅ‡∏ú‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Event ‡∏£‡∏ß‡∏° (Pixel + Make.com + Login)</h2>
  <div class="wrap-btns">
    <button class="btn" onclick="fire('PageView')">PageView</button>
    <button class="btn" onclick="fire('ViewContent')">ViewContent</button>
    <button class="btn" onclick="fire('AddToCart','Sony WF-1000XM5',8990)">AddToCart</button>
    <button class="btn" onclick="fire('Purchase','Sony WF-1000XM5',8990)">Purchase</button>
    <button class="btn" onclick="fire('Contact_LINE')">Contact_LINE</button>
    <button class="btn" onclick="fire('Contact_Telegram')">Contact_Telegram</button>
    <button class="btn" onclick="openLogin()">Login_Success</button>
    <button class="btn" onclick="openTopup()">Submit_Topup</button>
  </div>

  <div id="logBox" class="log">[LOG] ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Event</div>

  <!-- ‚úÖ Popup: Login -->
  <div class="popup" id="popupLogin">
    <div class="popup-content">
      <h3>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <div>
        <button class="btn-confirm" onclick="submitLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="btn-cancel" onclick="closeLogin()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Popup: Topup -->
  <div class="popup" id="popupTopup">
    <div class="popup-content">
      <h3>üí∞ ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°</h3>
      <input type="number" id="topupAmount" placeholder="‡πÄ‡∏ä‡πà‡∏ô 500" />
      <div>
        <button class="btn-confirm" onclick="submitTopup()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <button class="btn-cancel" onclick="closeTopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <script>
    const MAKE_WEBHOOK_URL = "https://hook.us2.make.com/js1dr6n6g8917p5q8ulbjpd9aoh8koci";
    const PLATFORM = "Meta Pixel + Make";
    const CHANNEL  = "Website";
    const CURRENCY = "THB";
    let USERNAME = "-";
    const logBox = document.getElementById("logBox");

    function log(msg){
      const t = new Date().toLocaleTimeString();
      logBox.textContent += `\n[${t}] ${msg}`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    async function fire(eventName, productName = "-", value = 0){
      fbq('trackCustom', eventName, { user: USERNAME, product_name: productName, value: value, currency: CURRENCY });
      const payload = {
        event_name: eventName,
        event_time: Math.floor(Date.now()/1000),
        url: window.location.href,
        product_name: productName,
        value: value,
        currency: CURRENCY,
        source: CHANNEL,
        platform: PLATFORM,
        username: USERNAME
      };
      try {
        const res = await fetch(MAKE_WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if(res.ok){ log(`‚úÖ Success ‚Üí ${eventName} (${USERNAME})`); }
        else { log(`‚ö†Ô∏è Failed (${res.status}) ‚Üí ${eventName}`); }
      } catch (err){ log(`‚ùå Error ‚Üí ${eventName}`); }
    }

    /* ‚úÖ LOGIN */
    function openLogin(){ document.getElementById("popupLogin").style.display = "flex"; }
    function closeLogin(){ document.getElementById("popupLogin").style.display = "none"; }

    async function submitLogin(){
      const u = document.getElementById("username").value.trim();
      const p = document.getElementById("password").value.trim();
      if(!u || !p){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username ‡πÅ‡∏•‡∏∞ Password"); return; }
      USERNAME = u;
      closeLogin();
      log(`üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${USERNAME}`);
      await fire('Login_Success', 'User Login', 0);
    }

    /* ‚úÖ TOPUP */
    function openTopup(){ document.getElementById("popupTopup").style.display = "flex"; }
    function closeTopup(){ document.getElementById("popupTopup").style.display = "none"; }

    async function submitTopup(){
      const amount = parseFloat(document.getElementById("topupAmount").value || 0);
      if(amount <= 0){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); return; }
      closeTopup();
      log(`üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏: ${amount} ‡∏ö‡∏≤‡∏ó`);
      await fire('Submit_Topup', 'Topup Custom Amount', amount);
    }
  </script>
</body>
</html>
